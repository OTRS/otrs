<?xml version="1.0" encoding="utf-8" ?>
<database Name="otrs">

<TableAlter Name="dynamic_field_value">

    <!-- improve index -->
    <IndexDrop Name="dynamic_field_value_field_values"/>
    <IndexCreate Name="dynamic_field_value_field_values">
        <IndexColumn Name="object_id"/>
        <IndexColumn Name="field_id"/>
    </IndexCreate>

</TableAlter>

<TableAlter Name="web_upload_cache">
    <ColumnAdd Name="disposition" Required="false" Size="15" Type="VARCHAR"/>
</TableAlter>

<TableAlter Name="article_attachment">
    <ColumnAdd Name="disposition" Required="false" Size="15" Type="VARCHAR"/>
</TableAlter>

<TableAlter Name="ticket">
    <ForeignKeyDrop ForeignTable="valid">
        <Reference Local="valid_id" Foreign="id"/>
    </ForeignKeyDrop>
    <ColumnDrop Name="valid_id"/>
</TableAlter>

<TableAlter Name="ticket_history">
    <ForeignKeyDrop ForeignTable="valid">
        <Reference Local="valid_id" Foreign="id"/>
    </ForeignKeyDrop>
    <ColumnDrop Name="valid_id"/>
</TableAlter>

<!-- remove pm_entity table as it is not longer needed with use of GUIDs -->
 <TableDrop Name="pm_entity"/>

<!-- personal_services - stores all "my services" -->
<TableCreate Name="personal_services">
    <Column Name="user_id" Required="true" Type="INTEGER"/>
    <Column Name="service_id" Required="true" Type="INTEGER"/>
    <Index Name="personal_services_user_id">
        <IndexColumn Name="user_id"/>
    </Index>
    <Index Name="personal_services_queue_id">
        <IndexColumn Name="service_id"/>
    </Index>
    <ForeignKey ForeignTable="users">
        <Reference Local="user_id" Foreign="id"/>
    </ForeignKey>
    <ForeignKey ForeignTable="service">
        <Reference Local="service_id" Foreign="id"/>
    </ForeignKey>
</TableCreate>

</database>
